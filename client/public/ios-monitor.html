<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>iOS Load Monitor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, monospace;
            font-size: 12px;
            background: #000;
            color: #0f0;
            padding: 10px;
            line-height: 1.4;
        }
        .header {
            background: #1a1a1a;
            padding: 10px;
            border: 1px solid #333;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .section {
            background: #0a0a0a;
            border: 1px solid #333;
            margin: 10px 0;
            border-radius: 5px;
            overflow: hidden;
        }
        .section-title {
            background: #1a1a1a;
            padding: 8px;
            font-weight: bold;
            color: #0ff;
            border-bottom: 1px solid #333;
        }
        .section-content {
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            padding: 3px 0;
            border-bottom: 1px solid #1a1a1a;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .info { color: #0ff; }
        button {
            width: 100%;
            padding: 12px;
            background: #1a1a1a;
            color: #0f0;
            border: 1px solid #333;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
        }
        button:active { background: #333; }
        .status { 
            padding: 5px; 
            margin: 3px 0;
            border-left: 3px solid;
        }
        .status.ok { border-color: #0f0; color: #0f0; }
        .status.fail { border-color: #f00; color: #f00; }
        .status.pending { border-color: #ff0; color: #ff0; }
        #resources { font-size: 11px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="success">üîç iOS LOAD MONITOR v2.0</div>
        <div class="info">Real-time resource loading tracker</div>
        <div class="info" id="time">-</div>
    </div>

    <button onclick="loadMainApp()">üöÄ LOAD MAIN APP & MONITOR</button>
    <button onclick="clearLogs()">üóëÔ∏è CLEAR LOGS</button>
    <button onclick="copyAllData()">üìã COPY ALL DATA</button>

    <div class="section">
        <div class="section-title">üìä RESOURCE LOADING STATUS</div>
        <div class="section-content" id="resources">
            <div class="pending">‚è≥ Waiting to start monitoring...</div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">üìù CONSOLE LOGS</div>
        <div class="section-content" id="console"></div>
    </div>

    <div class="section">
        <div class="section-title">‚ùå ERRORS</div>
        <div class="section-content" id="errors"></div>
    </div>

    <div class="section">
        <div class="section-title">‚ö†Ô∏è WARNINGS</div>
        <div class="section-content" id="warnings"></div>
    </div>

    <div class="section">
        <div class="section-title">üåê NETWORK REQUESTS</div>
        <div class="section-content" id="network"></div>
    </div>

    <script>
        var resourcesEl = document.getElementById('resources');
        var consoleEl = document.getElementById('console');
        var errorsEl = document.getElementById('errors');
        var warningsEl = document.getElementById('warnings');
        var networkEl = document.getElementById('network');
        var allData = [];
        
        function timestamp() {
            var now = new Date();
            return now.toLocaleTimeString() + '.' + now.getMilliseconds();
        }
        
        function log(msg, type, target) {
            var entry = '[' + timestamp() + '] ' + msg;
            allData.push({ time: timestamp(), type: type, msg: msg });
            
            var div = document.createElement('div');
            div.className = 'log-entry ' + (type || 'info');
            div.textContent = entry;
            
            target = target || consoleEl;
            target.insertBefore(div, target.firstChild);
            
            if (target.children.length > 100) {
                target.removeChild(target.lastChild);
            }
        }
        
        function clearLogs() {
            consoleEl.innerHTML = '<div class="info">Console cleared</div>';
            errorsEl.innerHTML = '<div class="info">Errors cleared</div>';
            warningsEl.innerHTML = '<div class="info">Warnings cleared</div>';
            networkEl.innerHTML = '<div class="info">Network cleared</div>';
            allData = [];
            log('Logs cleared', 'info');
        }
        
        function copyAllData() {
            var text = 'iOS LOAD MONITOR REPORT\n';
            text += '======================\n\n';
            text += 'Generated: ' + new Date().toString() + '\n\n';
            
            text += 'USER AGENT:\n' + navigator.userAgent + '\n\n';
            
            text += 'ALL LOGS:\n';
            allData.forEach(function(item) {
                text += item.time + ' [' + item.type + '] ' + item.msg + '\n';
            });
            
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(function() {
                        alert('‚úÖ Data copied to clipboard!');
                    });
                } else {
                    prompt('Copy this data:', text.substring(0, 1000) + '...');
                }
            } catch (e) {
                prompt('Copy this data:', text.substring(0, 1000) + '...');
            }
        }
        
        // Intercept console methods
        var originalLog = console.log;
        var originalError = console.error;
        var originalWarn = console.warn;
        
        console.log = function() {
            originalLog.apply(console, arguments);
            log('LOG: ' + Array.from(arguments).join(' '), 'info', consoleEl);
        };
        
        console.error = function() {
            originalError.apply(console, arguments);
            log('ERROR: ' + Array.from(arguments).join(' '), 'error', errorsEl);
        };
        
        console.warn = function() {
            originalWarn.apply(console, arguments);
            log('WARN: ' + Array.from(arguments).join(' '), 'warning', warningsEl);
        };
        
        // Global error handler
        window.addEventListener('error', function(e) {
            var msg = 'Error: ' + e.message;
            if (e.filename) msg += ' at ' + e.filename + ':' + e.lineno;
            log(msg, 'error', errorsEl);
            
            if (e.target && e.target.tagName) {
                var tagInfo = e.target.tagName.toLowerCase();
                if (e.target.src) tagInfo += ' src="' + e.target.src.substring(0, 100) + '"';
                if (e.target.href) tagInfo += ' href="' + e.target.href.substring(0, 100) + '"';
                log('Failed to load: ' + tagInfo, 'error', errorsEl);
            }
        }, true);
        
        // Unhandled promise rejection
        window.addEventListener('unhandledrejection', function(e) {
            log('Unhandled Promise: ' + e.reason, 'error', errorsEl);
        });
        
        // Monitor all fetch requests
        var originalFetch = window.fetch;
        window.fetch = function() {
            var url = arguments[0];
            var startTime = Date.now();
            log('FETCH START: ' + url, 'info', networkEl);
            
            return originalFetch.apply(this, arguments).then(function(response) {
                var duration = Date.now() - startTime;
                log('FETCH ' + response.status + ' (' + duration + 'ms): ' + url, 
                    response.ok ? 'success' : 'error', networkEl);
                return response;
            }).catch(function(err) {
                var duration = Date.now() - startTime;
                log('FETCH FAILED (' + duration + 'ms): ' + url + ' - ' + err.message, 
                    'error', networkEl);
                throw err;
            });
        };
        
        function loadMainApp() {
            log('=== LOADING MAIN APP ===', 'success');
            log('Starting resource monitor...', 'info');
            
            resourcesEl.innerHTML = '<div class="pending">‚è≥ Loading index.html...</div>';
            
            // Fetch the main app HTML
            fetch('https://servisbet-client.vercel.app/')
                .then(function(res) {
                    log('Main app HTML fetched: ' + res.status, res.ok ? 'success' : 'error');
                    return res.text();
                })
                .then(function(html) {
                    log('HTML length: ' + html.length + ' bytes', 'info');
                    
                    // Parse HTML and find all resources
                    var parser = new DOMParser();
                    var doc = parser.parseFromString(html, 'text/html');
                    
                    var resources = {
                        scripts: [],
                        styles: [],
                        links: [],
                        images: []
                    };
                    
                    // Find all scripts
                    var scripts = doc.querySelectorAll('script[src]');
                    scripts.forEach(function(script) {
                        resources.scripts.push(script.src || script.getAttribute('src'));
                    });
                    
                    // Find all stylesheets
                    var styles = doc.querySelectorAll('link[rel="stylesheet"]');
                    styles.forEach(function(style) {
                        resources.styles.push(style.href || style.getAttribute('href'));
                    });
                    
                    // Find all preload links
                    var links = doc.querySelectorAll('link[rel="preload"], link[rel="modulepreload"]');
                    links.forEach(function(link) {
                        resources.links.push(link.href || link.getAttribute('href'));
                    });
                    
                    log('Found ' + resources.scripts.length + ' scripts', 'info');
                    log('Found ' + resources.styles.length + ' stylesheets', 'info');
                    log('Found ' + resources.links.length + ' preload links', 'info');
                    
                    // Display resources
                    var output = '<div class="success">‚úÖ HTML Loaded (' + html.length + ' bytes)</div>';
                    
                    output += '<div class="section-title" style="margin-top:10px">üìú SCRIPTS:</div>';
                    if (resources.scripts.length === 0) {
                        output += '<div class="warning">‚ö†Ô∏è No scripts found!</div>';
                    }
                    resources.scripts.forEach(function(src, i) {
                        output += '<div class="pending" id="script-' + i + '">‚è≥ ' + src + '</div>';
                    });
                    
                    output += '<div class="section-title" style="margin-top:10px">üé® STYLES:</div>';
                    resources.styles.forEach(function(href, i) {
                        output += '<div class="pending" id="style-' + i + '">‚è≥ ' + href + '</div>';
                    });
                    
                    if (resources.links.length > 0) {
                        output += '<div class="section-title" style="margin-top:10px">üîó PRELOAD:</div>';
                        resources.links.forEach(function(href, i) {
                            output += '<div class="pending" id="link-' + i + '">‚è≥ ' + href + '</div>';
                        });
                    }
                    
                    resourcesEl.innerHTML = output;
                    
                    // Test loading each resource
                    testResources(resources);
                })
                .catch(function(err) {
                    log('Failed to load main app: ' + err.message, 'error');
                    resourcesEl.innerHTML = '<div class="fail">‚ùå Failed to load HTML: ' + err.message + '</div>';
                });
        }
        
        function testResources(resources) {
            log('Testing script loading...', 'info');
            
            // Test scripts
            resources.scripts.forEach(function(src, i) {
                var startTime = Date.now();
                fetch(src, { method: 'HEAD' })
                    .then(function(res) {
                        var duration = Date.now() - startTime;
                        var el = document.getElementById('script-' + i);
                        if (el) {
                            if (res.ok) {
                                el.className = 'status ok';
                                el.innerHTML = '‚úÖ [' + res.status + ' ' + duration + 'ms] ' + src;
                                log('Script OK: ' + src, 'success');
                            } else {
                                el.className = 'status fail';
                                el.innerHTML = '‚ùå [' + res.status + '] ' + src;
                                log('Script FAILED: ' + src + ' (' + res.status + ')', 'error');
                            }
                        }
                    })
                    .catch(function(err) {
                        var duration = Date.now() - startTime;
                        var el = document.getElementById('script-' + i);
                        if (el) {
                            el.className = 'status fail';
                            el.innerHTML = '‚ùå [ERROR ' + duration + 'ms] ' + src + ' - ' + err.message;
                            log('Script LOAD ERROR: ' + src + ' - ' + err.message, 'error');
                        }
                    });
            });
            
            // Test styles
            resources.styles.forEach(function(href, i) {
                var startTime = Date.now();
                fetch(href, { method: 'HEAD' })
                    .then(function(res) {
                        var duration = Date.now() - startTime;
                        var el = document.getElementById('style-' + i);
                        if (el) {
                            if (res.ok) {
                                el.className = 'status ok';
                                el.innerHTML = '‚úÖ [' + res.status + ' ' + duration + 'ms] ' + href;
                                log('Style OK: ' + href, 'success');
                            } else {
                                el.className = 'status fail';
                                el.innerHTML = '‚ùå [' + res.status + '] ' + href;
                                log('Style FAILED: ' + href + ' (' + res.status + ')', 'error');
                            }
                        }
                    })
                    .catch(function(err) {
                        var el = document.getElementById('style-' + i);
                        if (el) {
                            el.className = 'status fail';
                            el.innerHTML = '‚ùå [ERROR] ' + href + ' - ' + err.message;
                            log('Style LOAD ERROR: ' + href + ' - ' + err.message, 'error');
                        }
                    });
            });
        }
        
        // Update time
        setInterval(function() {
            document.getElementById('time').textContent = 'Current: ' + new Date().toLocaleTimeString();
        }, 1000);
        
        // Initialize
        log('iOS Load Monitor initialized', 'success');
        log('User Agent: ' + navigator.userAgent, 'info');
        log('Platform: ' + navigator.platform, 'info');
        log('Ready to monitor main app loading', 'success');
    </script>
</body>
</html>
